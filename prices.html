<main class="container">
  <section class="card">
    <h1>Clothing Prices</h1>

    <!-- Search + Sort controls -->
    <div class="search-wrapper">
      <input type="text" id="search" class="search-bar" placeholder="ðŸ” Search item...">
      <button class="clear-btn" onclick="document.getElementById('search').value=''; applyFilters();">&times;</button>
    </div>

    <div class="field">
      <label for="sort">Sort items:</label>
      <select id="sort">
        <option value="none">None</option>
        <option value="asc">Price: Lowest â†’ Highest</option>
        <option value="desc">Price: Highest â†’ Lowest</option>
        <option value="az">Alphabetical: A â†’ Z</option>
        <option value="za">Alphabetical: Z â†’ A</option>
      </select>
    </div>

    <!-- Section content -->
    <div id="section-content" class="grid"></div>
    <div class="no-results" id="no-results" style="display:none;">No items found.</div>

    <!-- Pagination buttons -->
    <div id="pagination" style="margin-top:20px; text-align:center;"></div>
  </section>
</main>

<script>
  let allPrices = [];
  let groupedSections = {};
  let currentSection = 1;

  async function loadPrices() {
    const res = await fetch('prices.json');
    allPrices = await res.json();

    // Group by section
    groupedSections = {};
    allPrices.forEach(entry => {
      if (!groupedSections[entry.section]) groupedSections[entry.section] = [];
      groupedSections[entry.section].push(entry);
    });

    applyFilters();
    renderPagination();
  }

  function renderSection(list) {
    const container = document.getElementById('section-content');
    const noResults = document.getElementById('no-results');
    container.innerHTML = '';

    if (list.length === 0) {
      noResults.style.display = 'block';
      return;
    } else {
      noResults.style.display = 'none';
    }

    list.forEach(entry => {
      const card = document.createElement('article');
      card.className = 'card item-card';

      const name = document.createElement('div');
      name.className = 'item-name';
      name.textContent = entry.item;

      const price = document.createElement('div');
      price.className = 'item-price';

      if (entry.min && entry.max && entry.min !== entry.max) {
        price.textContent = `${entry.min.toLocaleString()} - ${entry.max.toLocaleString()}c`;
      } else {
        price.textContent = `${entry.min.toLocaleString()}c`;
      }

      card.appendChild(name);
      card.appendChild(price);
      container.appendChild(card);
    });
  }

  function applyFilters() {
    const term = document.getElementById('search').value.toLowerCase();
    const sortOption = document.getElementById('sort').value;

    let filtered = groupedSections[currentSection] || [];
    filtered = filtered.filter(entry =>
      entry.item.toLowerCase().includes(term)
    );

    if (sortOption === 'asc') {
      filtered.sort((a, b) => a.min - b.min);
    } else if (sortOption === 'desc') {
      filtered.sort((a, b) => b.max - a.max);
    } else if (sortOption === 'az') {
      filtered.sort((a, b) => a.item.localeCompare(b.item));
    } else if (sortOption === 'za') {
      filtered.sort((a, b) => b.item.localeCompare(a.item));
    }

    renderSection(filtered);
  }

  function renderPagination() {
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';

    const sectionNumbers = Object.keys(groupedSections).map(Number).sort((a, b) => a - b);

    sectionNumbers.forEach(num => {
      const btn = document.createElement('button');
      btn.textContent = `Section ${num}`;
      btn.className = num === currentSection ? 'btn-primary' : 'btn-secondary';
      btn.onclick = () => {
        currentSection = num;
        applyFilters();
        renderPagination();
      };
      pagination.appendChild(btn);
    });
  }

  document.getElementById('search').addEventListener('input', applyFilters);
  document.getElementById('sort').addEventListener('change', applyFilters);

  loadPrices();
</script>
